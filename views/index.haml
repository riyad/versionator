!!! 5
!!!

%html
  %head
    %title Versionator
    %link{ :href => "stylesheet.css", :rel => "stylesheet", :type => "text/css" }
    %script{ :src => "javascripts/jquery-1.4.4.min.js" }
  %body
    %h1 Versionator
    #root
      - unless @dirs_that_dont_exist.empty?
        .message.error
          %h2 Directories not found
          %ul.vertical.list
            - @dirs_that_dont_exist.each do |dir|
              %li
                = image("folder-exists-not")
                = dir
      .container
      .container.directories
        %h2 Installations
        .container.installations
        - @dirs_that_exist.each do |dir|
          .container.installations
            %h3
              = image("folder")
              = dir
            - @installations[dir].each do |installation|
              %div{ :class => "item #{installation.basic_name}-installation" }
                .logo= logo_for(installation)
                %h4
                  %span.name= installation.app_name
                .installed-version
                  Installed Version:
                  %span.version= installation.installed_version
                .newest-version
                  Newest Version:
                  %span.version
                  = ajax_loader
                  %a.check-version.button
                    = image("version-detect")
                    Check
                .project-links
                  %a{ :href => installation.project_url }
                    = image("homepage-developer")
                    Project Website
                  - if installation.installed_version_detected?
                    %a{ :href => installation.project_url_for_installed_version }
                      = image("homepage-developer")
                      = installation.app_name
                      = installation.installed_version
                      Release
      #detectors.container
        = toggle_container('#detectors div.detectors')
        %h2
          Application Detectors
        .container.detectors
          %ul.horizontal.detectors.icon.list
            - @detectors.each do |det|
              %li
                %a{ :href => det.project_url }
                  = logo_for(det)
                  = det.app_name
      - @detectors.each do |detector|
        :javascript
          $(document).ready(function() {
            var inst = $(".#{detector.basic_name}-installation");
            var nv = inst.find(".newest-version");
            nv.find(".check-version.button").click(function() {
              nv.find(".version").html(""); // erase newest version text
              nv.find(".ajax-loader").show(); // show throbber
              $.get("/apps/#{detector.basic_name}/newest_version", function(data) {
                nv.find(".ajax-loader").hide(); // hide throbber
                nv.find(".version").html(data); // set newest version text
                // update button
                nv.find(".check-version.button").html("#{escape_javascript(image("version-detect"))} Recheck");
              });
            });
          });
